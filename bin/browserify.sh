#!/bin/bash -e
#
# Make the browser version of the code
#
cd `dirname $0`

VERSION=`grep version ../package.json | head -1 | cut '--delimiter=:' -f2 | tr -d ' ",'`
OUT_FILE=../lib/xgen-browser-${VERSION}.js
MIN_FILE=../lib/xgen-browser-min-${VERSION}.js

echo "// Generated by browserify.awk, do not edit"  >  ${OUT_FILE}

echo "// xgen-path.js" >>  ${OUT_FILE}
cat ../lib/xgen-path.js     | awk -f browserify.awk >>  ${OUT_FILE}

echo "// xgen-nodelist.js" >>  ${OUT_FILE}
cat ../lib/xgen-nodelist.js | awk -f browserify.awk >> ${OUT_FILE}

echo "// xgen-dom.js" >>  ${OUT_FILE}
cat ../lib/xgen-dom.js      | awk -f browserify.awk >> ${OUT_FILE}

echo "// xgen-browser-ext.js" >>  ${OUT_FILE}
cat ../lib/xgen-browser-ext.js      | awk -f browserify.awk >> ${OUT_FILE}

which jsmin && cat ${OUT_FILE} | jsmin > ${MIN_FILE} || :

# end with a zero
test -f ${OUT_FILE} && echo "Created ${OUT_FILE}"


cat ../lib/xgen-path.js | awk -f browserify.awk | cat - ../lib/xgen-jquery.js > ../jquery.xgen.js
cat ../xgen.jquery.json.in | sed "s/VERSION/${VERSION}/" > ../xgen.jquery.json

# end with a zero
test -f ../jquery.xgen.js && echo "Created ../jquery.xgen.js"
